<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Key H√¥m Nay</title>
  <style>
    body { font-family: Arial; display: flex; justify-content: center; align-items: center; height: 100vh; background: #f3f3f3; }
    .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); text-align: center; }
    .key-box { background: #ffe6f0; padding: 10px; border-radius: 5px; margin-top: 10px; display: inline-block; }
    .countdown { color: red; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="card" id="content">
    <h2>üîë Key c·ªßa b·∫°n</h2>
    <div id="keyBox"></div>
    <div id="countdown"></div>
  </div>

<script>
async function getUserIP() {
  try {
    const res = await fetch("https://ipapi.co/json/");
    const data = await res.json();
    return data.ip || "unknown";
  } catch {
    return "unknown";
  }
}

function generateKey(length) {
  const chars = 'abcdef0123456789';
  let key = '';
  for (let i = 0; i < length; i++) key += chars[Math.floor(Math.random() * chars.length)];
  return key;
}

(async () => {
  const ip = await getUserIP();
  const storageKey = "user_key";
  const storageExpire = "key_expire";
  const storageIP = "key_ip";

  let key = localStorage.getItem(storageKey);
  let expireAt = parseInt(localStorage.getItem(storageExpire)) || 0;
  let savedIP = localStorage.getItem(storageIP);
  const now = Date.now();

  if (!key || now > expireAt) {
    // T·∫°o key m·ªõi
    key = generateKey(32);
    expireAt = now + 60 * 60 * 1000;
    localStorage.setItem(storageKey, key);
    localStorage.setItem(storageExpire, expireAt);
    localStorage.setItem(storageIP, ip);
    savedIP = ip;
  }

  // N·∫øu IP hi·ªán t·∫°i kh√°c v·ªõi IP ƒë√£ l∆∞u ‚Üí b√°o l·ªói
  if (ip !== savedIP) {
    document.getElementById("content").innerHTML = "<h2>üö´ B·∫°n kh√¥ng th·ªÉ truy c·∫≠p link ƒë·ªÉ l·∫•y key c·ªßa ng∆∞·ªùi kh√°c!</h2>";
    return;
  }

  // Hi·ªÉn th·ªã key v√† countdown
  document.getElementById("keyBox").innerText = key;

  const countdownEl = document.getElementById("countdown");
  setInterval(() => {
    const distance = expireAt - Date.now();
    if (distance <= 0) {
      countdownEl.innerText = "‚õî ƒê√£ h·∫øt h·∫°n!";
      return;
    }
    const h = Math.floor(distance / (1000 * 60 * 60));
    const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const s = Math.floor((distance % (1000 * 60)) / 1000);
    countdownEl.innerText = `‚åõ C√≤n l·∫°i: ${h}h ${m}m ${s}s`;
  }, 1000);
})();
</script>
</body>
</html>
